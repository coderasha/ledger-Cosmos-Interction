{"remainingRequest":"/home/admin1/Desktop/ledger-cosmos-js (copy)/node_modules/babel-loader/lib/index.js!/home/admin1/Desktop/ledger-cosmos-js (copy)/src/index.js","dependencies":[{"path":"/home/admin1/Desktop/ledger-cosmos-js (copy)/src/index.js","mtime":1573038128251},{"path":"/home/admin1/Desktop/ledger-cosmos-js (copy)/.babelrc","mtime":1573041144236},{"path":"/home/admin1/Desktop/ledger-cosmos-js (copy)/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/admin1/Desktop/ledger-cosmos-js (copy)/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjsKCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogIChjKSAyMDE5IFpvbmRhWCBHbWJICiAqICAoYykgMjAxNi0yMDE3IExlZGdlcgogKgogKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwppbXBvcnQgY3J5cHRvIGZyb20gImNyeXB0byI7CmltcG9ydCBSaXBlbWQxNjAgZnJvbSAicmlwZW1kMTYwIjsKaW1wb3J0IGJlY2gzMiBmcm9tICJiZWNoMzIiOwppbXBvcnQgeyBzZXJpYWxpemVQYXRodjEsIHNpZ25TZW5kQ2h1bmt2MSB9IGZyb20gIi4vaGVscGVyVjEiOwppbXBvcnQgeyBzZXJpYWxpemVQYXRodjIsIHNpZ25TZW5kQ2h1bmt2MiB9IGZyb20gIi4vaGVscGVyVjIiOwppbXBvcnQgeyBBUFBfS0VZLCBDSFVOS19TSVpFLCBDTEEsIElOUywgZXJyb3JDb2RlVG9TdHJpbmcsIGdldFZlcnNpb24gYXMgX2dldFZlcnNpb24sIHByb2Nlc3NFcnJvclJlc3BvbnNlIH0gZnJvbSAiLi9jb21tb24iOwoKdmFyIENvc21vc0FwcCA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIENvc21vc0FwcCh0cmFuc3BvcnQpIHsKICAgIHZhciBzY3JhbWJsZUtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogQVBQX0tFWTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29zbW9zQXBwKTsKCiAgICBpZiAoIXRyYW5zcG9ydCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRyYW5zcG9ydCBoYXMgbm90IGJlZW4gZGVmaW5lZCIpOwogICAgfQoKICAgIHRoaXMudHJhbnNwb3J0ID0gdHJhbnNwb3J0OwogICAgdHJhbnNwb3J0LmRlY29yYXRlQXBwQVBJTWV0aG9kcyh0aGlzLCBbImdldFZlcnNpb24iLCAic2lnbiIsICJnZXRBZGRyZXNzQW5kUHViS2V5IiwgImFwcEluZm8iLCAiZGV2aWNlSW5mbyIsICJnZXRCZWNoMzJGcm9tUEsiXSwgc2NyYW1ibGVLZXkpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKENvc21vc0FwcCwgW3sKICAgIGtleTogInNlcmlhbGl6ZVBhdGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zZXJpYWxpemVQYXRoID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocGF0aCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBfZ2V0VmVyc2lvbih0aGlzLnRyYW5zcG9ydCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRoaXMudmVyc2lvblJlc3BvbnNlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gdGhpcy52ZXJzaW9uUmVzcG9uc2UubWFqb3I7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gX2NvbnRleHQudDAgPT09IDEgPyA2IDogX2NvbnRleHQudDAgPT09IDIgPyA3IDogODsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBzZXJpYWxpemVQYXRodjEocGF0aCkpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBzZXJpYWxpemVQYXRodjIocGF0aCkpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHJldHVybl9jb2RlOiAweDY0MDAsCiAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6ICJBcHAgVmVyc2lvbiBpcyBub3Qgc3VwcG9ydGVkIgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzZXJpYWxpemVQYXRoKF94KSB7CiAgICAgICAgcmV0dXJuIF9zZXJpYWxpemVQYXRoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZXJpYWxpemVQYXRoOwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2lnbkdldENodW5rcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NpZ25HZXRDaHVua3MgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIocGF0aCwgbWVzc2FnZSkgewogICAgICAgIHZhciBzZXJpYWxpemVkUGF0aCwgY2h1bmtzLCBidWZmZXIsIGksIGVuZDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZVBhdGgocGF0aCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRQYXRoID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBjaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgIGNodW5rcy5wdXNoKHNlcmlhbGl6ZWRQYXRoKTsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBidWZmZXIubGVuZ3RoOyBpICs9IENIVU5LX1NJWkUpIHsKICAgICAgICAgICAgICAgICAgZW5kID0gaSArIENIVU5LX1NJWkU7CgogICAgICAgICAgICAgICAgICBpZiAoaSA+IGJ1ZmZlci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBlbmQgPSBidWZmZXIubGVuZ3RoOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjaHVua3MucHVzaChidWZmZXIuc2xpY2UoaSwgZW5kKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGNodW5rcyk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNpZ25HZXRDaHVua3MoX3gyLCBfeDMpIHsKICAgICAgICByZXR1cm4gX3NpZ25HZXRDaHVua3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNpZ25HZXRDaHVua3M7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJnZXRWZXJzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0VmVyc2lvbjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gX2dldFZlcnNpb24odGhpcy50cmFuc3BvcnQpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLnZlcnNpb25SZXNwb25zZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHRoaXMudmVyc2lvblJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1cm4gX2dldFZlcnNpb24yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRWZXJzaW9uOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiYXBwSW5mbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2FwcEluZm8gPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdGhpcy50cmFuc3BvcnQuc2VuZCgweGIwLCAweDAxLCAwLCAwKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB2YXIgZXJyb3JDb2RlRGF0YSA9IHJlc3BvbnNlLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkNvZGUgPSBlcnJvckNvZGVEYXRhWzBdICogMjU2ICsgZXJyb3JDb2RlRGF0YVsxXTsKICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgICAgICAgICAgICB2YXIgYXBwTmFtZSA9ICJlcnIiOwogICAgICAgICAgICAgICAgICB2YXIgYXBwVmVyc2lvbiA9ICJlcnIiOwogICAgICAgICAgICAgICAgICB2YXIgZmxhZ0xlbiA9IDA7CiAgICAgICAgICAgICAgICAgIHZhciBmbGFnc1ZhbHVlID0gMDsKCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZVswXSAhPT0gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIExlZGdlciByZXNwb25kcyB3aXRoIGZvcm1hdCBJRCAxLiBUaGVyZSBpcyBubyBzcGVjIGZvciBhbnkgZm9ybWF0ICE9IDEKICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3JfbWVzc2FnZSA9ICJyZXNwb25zZSBmb3JtYXQgSUQgbm90IHJlY29nbml6ZWQiOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZXR1cm5fY29kZSA9IDB4OTAwMTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXBwTmFtZUxlbiA9IHJlc3BvbnNlWzFdOwogICAgICAgICAgICAgICAgICAgIGFwcE5hbWUgPSByZXNwb25zZS5zbGljZSgyLCAyICsgYXBwTmFtZUxlbikudG9TdHJpbmcoImFzY2lpIik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IDIgKyBhcHBOYW1lTGVuOwogICAgICAgICAgICAgICAgICAgIHZhciBhcHBWZXJzaW9uTGVuID0gcmVzcG9uc2VbaWR4XTsKICAgICAgICAgICAgICAgICAgICBpZHggKz0gMTsKICAgICAgICAgICAgICAgICAgICBhcHBWZXJzaW9uID0gcmVzcG9uc2Uuc2xpY2UoaWR4LCBpZHggKyBhcHBWZXJzaW9uTGVuKS50b1N0cmluZygiYXNjaWkiKTsKICAgICAgICAgICAgICAgICAgICBpZHggKz0gYXBwVmVyc2lvbkxlbjsKICAgICAgICAgICAgICAgICAgICB2YXIgYXBwRmxhZ3NMZW4gPSByZXNwb25zZVtpZHhdOwogICAgICAgICAgICAgICAgICAgIGlkeCArPSAxOwogICAgICAgICAgICAgICAgICAgIGZsYWdMZW4gPSBhcHBGbGFnc0xlbjsKICAgICAgICAgICAgICAgICAgICBmbGFnc1ZhbHVlID0gcmVzcG9uc2VbaWR4XTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm5fY29kZTogcmV0dXJuQ29kZSwKICAgICAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlOiBlcnJvckNvZGVUb1N0cmluZyhyZXR1cm5Db2RlKSwKICAgICAgICAgICAgICAgICAgICAvLyAvLwogICAgICAgICAgICAgICAgICAgIGFwcE5hbWU6IGFwcE5hbWUsCiAgICAgICAgICAgICAgICAgICAgYXBwVmVyc2lvbjogYXBwVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBmbGFnTGVuOiBmbGFnTGVuLAogICAgICAgICAgICAgICAgICAgIGZsYWdzVmFsdWU6IGZsYWdzVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2UKICAgICAgICAgICAgICAgICAgICBmbGFnX3JlY292ZXJ5OiAoZmxhZ3NWYWx1ZSAmIDEpICE9PSAwLAogICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCiAgICAgICAgICAgICAgICAgICAgZmxhZ19zaWduZWRfbWN1X2NvZGU6IChmbGFnc1ZhbHVlICYgMikgIT09IDAsCiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2UKICAgICAgICAgICAgICAgICAgICBmbGFnX29uYm9hcmRlZDogKGZsYWdzVmFsdWUgJiA0KSAhPT0gMCwKICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQogICAgICAgICAgICAgICAgICAgIGZsYWdfcGluX3ZhbGlkYXRlZDogKGZsYWdzVmFsdWUgJiAxMjgpICE9PSAwCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LCBwcm9jZXNzRXJyb3JSZXNwb25zZSkpOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBhcHBJbmZvKCkgewogICAgICAgIHJldHVybiBfYXBwSW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gYXBwSW5mbzsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImRldmljZUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kZXZpY2VJbmZvID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHRoaXMudHJhbnNwb3J0LnNlbmQoMHhlMCwgMHgwMSwgMCwgMCwgQnVmZmVyLmZyb20oW10pLCBbMHg5MDAwLCAweDZlMDBdKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB2YXIgZXJyb3JDb2RlRGF0YSA9IHJlc3BvbnNlLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkNvZGUgPSBlcnJvckNvZGVEYXRhWzBdICogMjU2ICsgZXJyb3JDb2RlRGF0YVsxXTsKCiAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5Db2RlID09PSAweDZlMDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuX2NvZGU6IHJldHVybkNvZGUsCiAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlOiAiVGhpcyBjb21tYW5kIGlzIG9ubHkgYXZhaWxhYmxlIGluIHRoZSBEYXNoYm9hcmQiCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldElkID0gcmVzcG9uc2Uuc2xpY2UoMCwgNCkudG9TdHJpbmcoImhleCIpOwogICAgICAgICAgICAgICAgICB2YXIgcG9zID0gNDsKICAgICAgICAgICAgICAgICAgdmFyIHNlY3VyZUVsZW1lbnRWZXJzaW9uTGVuID0gcmVzcG9uc2VbcG9zXTsKICAgICAgICAgICAgICAgICAgcG9zICs9IDE7CiAgICAgICAgICAgICAgICAgIHZhciBzZVZlcnNpb24gPSByZXNwb25zZS5zbGljZShwb3MsIHBvcyArIHNlY3VyZUVsZW1lbnRWZXJzaW9uTGVuKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICBwb3MgKz0gc2VjdXJlRWxlbWVudFZlcnNpb25MZW47CiAgICAgICAgICAgICAgICAgIHZhciBmbGFnc0xlbiA9IHJlc3BvbnNlW3Bvc107CiAgICAgICAgICAgICAgICAgIHBvcyArPSAxOwogICAgICAgICAgICAgICAgICB2YXIgZmxhZyA9IHJlc3BvbnNlLnNsaWNlKHBvcywgcG9zICsgZmxhZ3NMZW4pLnRvU3RyaW5nKCJoZXgiKTsKICAgICAgICAgICAgICAgICAgcG9zICs9IGZsYWdzTGVuOwogICAgICAgICAgICAgICAgICB2YXIgbWN1VmVyc2lvbkxlbiA9IHJlc3BvbnNlW3Bvc107CiAgICAgICAgICAgICAgICAgIHBvcyArPSAxOyAvLyBQYXRjaCBpc3N1ZSBpbiBtY3UgdmVyc2lvbgoKICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHJlc3BvbnNlLnNsaWNlKHBvcywgcG9zICsgbWN1VmVyc2lvbkxlbik7CgogICAgICAgICAgICAgICAgICBpZiAodG1wW21jdVZlcnNpb25MZW4gLSAxXSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRtcCA9IHJlc3BvbnNlLnNsaWNlKHBvcywgcG9zICsgbWN1VmVyc2lvbkxlbiAtIDEpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgbWN1VmVyc2lvbiA9IHRtcC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHJldHVybl9jb2RlOiByZXR1cm5Db2RlLAogICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yQ29kZVRvU3RyaW5nKHJldHVybkNvZGUpLAogICAgICAgICAgICAgICAgICAgIC8vIC8vCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SWQ6IHRhcmdldElkLAogICAgICAgICAgICAgICAgICAgIHNlVmVyc2lvbjogc2VWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgIGZsYWc6IGZsYWcsCiAgICAgICAgICAgICAgICAgICAgbWN1VmVyc2lvbjogbWN1VmVyc2lvbgogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSwgcHJvY2Vzc0Vycm9yUmVzcG9uc2UpKTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZGV2aWNlSW5mbygpIHsKICAgICAgICByZXR1cm4gX2RldmljZUluZm8uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRldmljZUluZm87CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJwdWJsaWNLZXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wdWJsaWNLZXkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYocGF0aCkgewogICAgICAgIHZhciBzZXJpYWxpemVkUGF0aCwgZGF0YTsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZVBhdGgocGF0aCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRQYXRoID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gQnVmZmVyLmNvbmNhdChbQ29zbW9zQXBwLnNlcmlhbGl6ZUhSUCgiY29zbW9zIiksIHNlcmlhbGl6ZWRQYXRoXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgdGhpcy50cmFuc3BvcnQuc2VuZChDTEEsIElOUy5HRVRfQUREUl9TRUNQMjU2SzEsIDAsIDAsIGRhdGEsIFsweDkwMDBdKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB2YXIgZXJyb3JDb2RlRGF0YSA9IHJlc3BvbnNlLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkNvZGUgPSBlcnJvckNvZGVEYXRhWzBdICogMjU2ICsgZXJyb3JDb2RlRGF0YVsxXTsKICAgICAgICAgICAgICAgICAgdmFyIGNvbXByZXNzZWRQayA9IEJ1ZmZlci5mcm9tKHJlc3BvbnNlLnNsaWNlKDAsIDMzKSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgcGs6ICJPQlNPTEVURSBQUk9QRVJUWSIsCiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZF9wazogY29tcHJlc3NlZFBrLAogICAgICAgICAgICAgICAgICAgIHJldHVybl9jb2RlOiByZXR1cm5Db2RlLAogICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yQ29kZVRvU3RyaW5nKHJldHVybkNvZGUpCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LCBwcm9jZXNzRXJyb3JSZXNwb25zZSkpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwdWJsaWNLZXkoX3g0KSB7CiAgICAgICAgcmV0dXJuIF9wdWJsaWNLZXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHB1YmxpY0tleTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEFkZHJlc3NBbmRQdWJLZXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRBZGRyZXNzQW5kUHViS2V5ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KHBhdGgsIGhycCkgewogICAgICAgIHZhciBzZXJpYWxpemVkUGF0aCwgZGF0YTsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZVBhdGgocGF0aCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRQYXRoID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gQnVmZmVyLmNvbmNhdChbQ29zbW9zQXBwLnNlcmlhbGl6ZUhSUChocnApLCBzZXJpYWxpemVkUGF0aF0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIHRoaXMudHJhbnNwb3J0LnNlbmQoQ0xBLCBJTlMuR0VUX0FERFJfU0VDUDI1NksxLCAxLCAwLCBkYXRhLCBbMHg5MDAwXSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgdmFyIGVycm9yQ29kZURhdGEgPSByZXNwb25zZS5zbGljZSgtMik7CiAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5Db2RlID0gZXJyb3JDb2RlRGF0YVswXSAqIDI1NiArIGVycm9yQ29kZURhdGFbMV07CiAgICAgICAgICAgICAgICAgIHZhciBjb21wcmVzc2VkUGsgPSBCdWZmZXIuZnJvbShyZXNwb25zZS5zbGljZSgwLCAzMykpOwogICAgICAgICAgICAgICAgICB2YXIgYmVjaDMyQWRkcmVzcyA9IEJ1ZmZlci5mcm9tKHJlc3BvbnNlLnNsaWNlKDMzLCAtMikpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgYmVjaDMyX2FkZHJlc3M6IGJlY2gzMkFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZF9wazogY29tcHJlc3NlZFBrLAogICAgICAgICAgICAgICAgICAgIHJldHVybl9jb2RlOiByZXR1cm5Db2RlLAogICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yQ29kZVRvU3RyaW5nKHJldHVybkNvZGUpCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LCBwcm9jZXNzRXJyb3JSZXNwb25zZSkpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRBZGRyZXNzQW5kUHViS2V5KF94NSwgX3g2KSB7CiAgICAgICAgcmV0dXJuIF9nZXRBZGRyZXNzQW5kUHViS2V5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRBZGRyZXNzQW5kUHViS2V5OwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2lnblNlbmRDaHVuayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NpZ25TZW5kQ2h1bmsgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoY2h1bmtJZHgsIGNodW5rTnVtLCBjaHVuaykgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnQwID0gdGhpcy52ZXJzaW9uUmVzcG9uc2UubWFqb3I7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IF9jb250ZXh0OC50MCA9PT0gMSA/IDMgOiBfY29udGV4dDgudDAgPT09IDIgPyA0IDogNTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgc2lnblNlbmRDaHVua3YxKHRoaXMsIGNodW5rSWR4LCBjaHVua051bSwgY2h1bmspKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHNpZ25TZW5kQ2h1bmt2Mih0aGlzLCBjaHVua0lkeCwgY2h1bmtOdW0sIGNodW5rKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHJldHVybl9jb2RlOiAweDY0MDAsCiAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6ICJBcHAgVmVyc2lvbiBpcyBub3Qgc3VwcG9ydGVkIgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNpZ25TZW5kQ2h1bmsoX3g3LCBfeDgsIF94OSkgewogICAgICAgIHJldHVybiBfc2lnblNlbmRDaHVuay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2lnblNlbmRDaHVuazsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInNpZ24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zaWduID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChwYXRoLCBtZXNzYWdlKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIGNodW5rczsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2lnbkdldENodW5rcyhwYXRoLCBtZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgY2h1bmtzID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCB0aGlzLnNpZ25TZW5kQ2h1bmsoMSwgY2h1bmtzLmxlbmd0aCwgY2h1bmtzWzBdLCBbMHg5MDAwXSkudGhlbigKICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICBfcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0LCBpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5fY29kZTogcmVzcG9uc2UucmV0dXJuX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6IHJlc3BvbnNlLmVycm9yX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZTogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpIDwgY2h1bmtzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNpZ25TZW5kQ2h1bmsoMSArIGksIGNodW5rcy5sZW5ndGgsIGNodW5rc1tpXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHJlc3VsdC5yZXR1cm5fY29kZSAhPT0gMHg5MDAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJicmVhayIsIDExKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5fY29kZTogcmVzdWx0LnJldHVybl9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlOiByZXN1bHQuZXJyb3JfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLy8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZTogcmVzdWx0LnNpZ25hdHVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MTIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpLCBwcm9jZXNzRXJyb3JSZXNwb25zZSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNpZ24oX3gxMCwgX3gxMSkgewogICAgICAgIHJldHVybiBfc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2lnbjsKICAgIH0oKQogIH1dLCBbewogICAga2V5OiAic2VyaWFsaXplSFJQIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXJpYWxpemVIUlAoaHJwKSB7CiAgICAgIGlmIChocnAgPT0gbnVsbCB8fCBocnAubGVuZ3RoIDwgMyB8fCBocnAubGVuZ3RoID4gODMpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgSFJQIik7CiAgICAgIH0KCiAgICAgIHZhciBidWYgPSBCdWZmZXIuYWxsb2MoMSArIGhycC5sZW5ndGgpOwogICAgICBidWYud3JpdGVVSW50OChocnAubGVuZ3RoLCAwKTsKICAgICAgYnVmLndyaXRlKGhycCwgMSk7CiAgICAgIHJldHVybiBidWY7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QmVjaDMyRnJvbVBLIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCZWNoMzJGcm9tUEsoaHJwLCBwaykgewogICAgICBpZiAocGsubGVuZ3RoICE9PSAzMykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiZXhwZWN0ZWQgY29tcHJlc3NlZCBwdWJsaWMga2V5IFszMSBieXRlc10iKTsKICAgICAgfQoKICAgICAgdmFyIGhhc2hTaGEyNTYgPSBjcnlwdG8uY3JlYXRlSGFzaCgic2hhMjU2IikudXBkYXRlKHBrKS5kaWdlc3QoKTsKICAgICAgdmFyIGhhc2hSaXAgPSBuZXcgUmlwZW1kMTYwKCkudXBkYXRlKGhhc2hTaGEyNTYpLmRpZ2VzdCgpOwogICAgICByZXR1cm4gYmVjaDMyLmVuY29kZShocnAsIGJlY2gzMi50b1dvcmRzKGhhc2hSaXApKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBDb3Ntb3NBcHA7Cn0oKTsKCmV4cG9ydCB7IENvc21vc0FwcCBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/home/admin1/Desktop/ledger-cosmos-js (copy)/src/index.js"],"names":["crypto","Ripemd160","bech32","serializePathv1","signSendChunkv1","serializePathv2","signSendChunkv2","APP_KEY","CHUNK_SIZE","CLA","INS","errorCodeToString","getVersion","processErrorResponse","CosmosApp","transport","scrambleKey","Error","decorateAppAPIMethods","path","versionResponse","major","return_code","error_message","message","serializePath","serializedPath","chunks","push","buffer","Buffer","from","i","length","end","slice","send","then","response","errorCodeData","returnCode","result","appName","appVersion","flagLen","flagsValue","appNameLen","toString","idx","appVersionLen","appFlagsLen","flag_recovery","flag_signed_mcu_code","flag_onboarded","flag_pin_validated","targetId","pos","secureElementVersionLen","seVersion","flagsLen","flag","mcuVersionLen","tmp","mcuVersion","data","concat","serializeHRP","GET_ADDR_SECP256K1","compressedPk","pk","compressed_pk","hrp","bech32Address","bech32_address","chunkIdx","chunkNum","chunk","signGetChunks","signSendChunk","signature","buf","alloc","writeUInt8","write","hashSha256","createHash","update","digest","hashRip","encode","toWords"],"mappings":"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","sourcesContent":["/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\n\nimport crypto from \"crypto\";\nimport Ripemd160 from \"ripemd160\";\nimport bech32 from \"bech32\";\nimport { serializePathv1, signSendChunkv1 } from \"./helperV1\";\nimport { serializePathv2, signSendChunkv2 } from \"./helperV2\";\nimport { APP_KEY, CHUNK_SIZE, CLA, INS, errorCodeToString, getVersion, processErrorResponse } from \"./common\";\n\nexport default class CosmosApp {\n  constructor(transport, scrambleKey = APP_KEY) {\n    if (!transport) {\n      throw new Error(\"Transport has not been defined\");\n    }\n\n    this.transport = transport;\n    transport.decorateAppAPIMethods(\n      this,\n      [\"getVersion\", \"sign\", \"getAddressAndPubKey\", \"appInfo\", \"deviceInfo\", \"getBech32FromPK\"],\n      scrambleKey,\n    );\n  }\n\n  static serializeHRP(hrp) {\n    if (hrp == null || hrp.length < 3 || hrp.length > 83) {\n      throw new Error(\"Invalid HRP\");\n    }\n    const buf = Buffer.alloc(1 + hrp.length);\n    buf.writeUInt8(hrp.length, 0);\n    buf.write(hrp, 1);\n    return buf;\n  }\n\n  static getBech32FromPK(hrp, pk) {\n    if (pk.length !== 33) {\n      throw new Error(\"expected compressed public key [31 bytes]\");\n    }\n    const hashSha256 = crypto\n      .createHash(\"sha256\")\n      .update(pk)\n      .digest();\n    const hashRip = new Ripemd160().update(hashSha256).digest();\n    return bech32.encode(hrp, bech32.toWords(hashRip));\n  }\n\n  async serializePath(path) {\n    this.versionResponse = await getVersion(this.transport);\n    switch (this.versionResponse.major) {\n      case 1:\n        return serializePathv1(path);\n      case 2:\n        return serializePathv2(path);\n      default:\n        return {\n          return_code: 0x6400,\n          error_message: \"App Version is not supported\",\n        };\n    }\n  }\n\n  async signGetChunks(path, message) {\n    const serializedPath = await this.serializePath(path);\n\n    const chunks = [];\n    chunks.push(serializedPath);\n    const buffer = Buffer.from(message);\n\n    for (let i = 0; i < buffer.length; i += CHUNK_SIZE) {\n      let end = i + CHUNK_SIZE;\n      if (i > buffer.length) {\n        end = buffer.length;\n      }\n      chunks.push(buffer.slice(i, end));\n    }\n\n    return chunks;\n  }\n\n  async getVersion() {\n    this.versionResponse = await getVersion(this.transport);\n    return this.versionResponse;\n  }\n\n  async appInfo() {\n    return this.transport.send(0xb0, 0x01, 0, 0).then(response => {\n      const errorCodeData = response.slice(-2);\n      const returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n      const result = {};\n\n      let appName = \"err\";\n      let appVersion = \"err\";\n      let flagLen = 0;\n      let flagsValue = 0;\n\n      if (response[0] !== 1) {\n        // Ledger responds with format ID 1. There is no spec for any format != 1\n        result.error_message = \"response format ID not recognized\";\n        result.return_code = 0x9001;\n      } else {\n        const appNameLen = response[1];\n        appName = response.slice(2, 2 + appNameLen).toString(\"ascii\");\n        let idx = 2 + appNameLen;\n        const appVersionLen = response[idx];\n        idx += 1;\n        appVersion = response.slice(idx, idx + appVersionLen).toString(\"ascii\");\n        idx += appVersionLen;\n        const appFlagsLen = response[idx];\n        idx += 1;\n        flagLen = appFlagsLen;\n        flagsValue = response[idx];\n      }\n\n      return {\n        return_code: returnCode,\n        error_message: errorCodeToString(returnCode),\n        // //\n        appName,\n        appVersion,\n        flagLen,\n        flagsValue,\n        // eslint-disable-next-line no-bitwise\n        flag_recovery: (flagsValue & 1) !== 0,\n        // eslint-disable-next-line no-bitwise\n        flag_signed_mcu_code: (flagsValue & 2) !== 0,\n        // eslint-disable-next-line no-bitwise\n        flag_onboarded: (flagsValue & 4) !== 0,\n        // eslint-disable-next-line no-bitwise\n        flag_pin_validated: (flagsValue & 128) !== 0,\n      };\n    }, processErrorResponse);\n  }\n\n  async deviceInfo() {\n    return this.transport.send(0xe0, 0x01, 0, 0, Buffer.from([]), [0x9000, 0x6e00]).then(response => {\n      const errorCodeData = response.slice(-2);\n      const returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n      if (returnCode === 0x6e00) {\n        return {\n          return_code: returnCode,\n          error_message: \"This command is only available in the Dashboard\",\n        };\n      }\n\n      const targetId = response.slice(0, 4).toString(\"hex\");\n\n      let pos = 4;\n      const secureElementVersionLen = response[pos];\n      pos += 1;\n      const seVersion = response.slice(pos, pos + secureElementVersionLen).toString();\n      pos += secureElementVersionLen;\n\n      const flagsLen = response[pos];\n      pos += 1;\n      const flag = response.slice(pos, pos + flagsLen).toString(\"hex\");\n      pos += flagsLen;\n\n      const mcuVersionLen = response[pos];\n      pos += 1;\n      // Patch issue in mcu version\n      let tmp = response.slice(pos, pos + mcuVersionLen);\n      if (tmp[mcuVersionLen - 1] === 0) {\n        tmp = response.slice(pos, pos + mcuVersionLen - 1);\n      }\n      const mcuVersion = tmp.toString();\n\n      return {\n        return_code: returnCode,\n        error_message: errorCodeToString(returnCode),\n        // //\n        targetId,\n        seVersion,\n        flag,\n        mcuVersion,\n      };\n    }, processErrorResponse);\n  }\n\n  async publicKey(path) {\n    const serializedPath = await this.serializePath(path);\n    const data = Buffer.concat([CosmosApp.serializeHRP(\"cosmos\"), serializedPath]);\n    return this.transport.send(CLA, INS.GET_ADDR_SECP256K1, 0, 0, data, [0x9000]).then(response => {\n      const errorCodeData = response.slice(-2);\n      const returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n      const compressedPk = Buffer.from(response.slice(0, 33));\n\n      return {\n        pk: \"OBSOLETE PROPERTY\",\n        compressed_pk: compressedPk,\n        return_code: returnCode,\n        error_message: errorCodeToString(returnCode),\n      };\n    }, processErrorResponse);\n  }\n\n  async getAddressAndPubKey(path, hrp) {\n    const serializedPath = await this.serializePath(path);\n    const data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n    return this.transport.send(CLA, INS.GET_ADDR_SECP256K1, 1, 0, data, [0x9000]).then(response => {\n      const errorCodeData = response.slice(-2);\n      const returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n      const compressedPk = Buffer.from(response.slice(0, 33));\n      const bech32Address = Buffer.from(response.slice(33, -2)).toString();\n\n      return {\n        bech32_address: bech32Address,\n        compressed_pk: compressedPk,\n        return_code: returnCode,\n        error_message: errorCodeToString(returnCode),\n      };\n    }, processErrorResponse);\n  }\n\n  async signSendChunk(chunkIdx, chunkNum, chunk) {\n    switch (this.versionResponse.major) {\n      case 1:\n        return signSendChunkv1(this, chunkIdx, chunkNum, chunk);\n      case 2:\n        return signSendChunkv2(this, chunkIdx, chunkNum, chunk);\n      default:\n        return {\n          return_code: 0x6400,\n          error_message: \"App Version is not supported\",\n        };\n    }\n  }\n\n  async sign(path, message) {\n    const chunks = await this.signGetChunks(path, message);\n\n    return this.signSendChunk(1, chunks.length, chunks[0], [0x9000]).then(async response => {\n      let result = {\n        return_code: response.return_code,\n        error_message: response.error_message,\n        signature: null,\n      };\n\n      for (let i = 1; i < chunks.length; i += 1) {\n        // eslint-disable-next-line no-await-in-loop\n        result = await this.signSendChunk(1 + i, chunks.length, chunks[i]);\n        if (result.return_code !== 0x9000) {\n          break;\n        }\n      }\n\n      return {\n        return_code: result.return_code,\n        error_message: result.error_message,\n        // ///\n        signature: result.signature,\n      };\n    }, processErrorResponse);\n  }\n}\n"]}]}